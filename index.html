<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Custom Piano Sheet Player</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      body {
        margin: 0;
        padding: 0;
        overflow-x: hidden;
      }
      .stars-bg {
        background: linear-gradient(to bottom, #001a4d, #0d47a1, #1976d2);
        position: relative;
        overflow: hidden;
      }
      .stars-bg::before {
        content: '';
        position: absolute;
        width: 100%;
        height: 100%;
        background-image: 
          radial-gradient(2px 2px at 20% 30%, white, transparent),
          radial-gradient(2px 2px at 60% 70%, white, transparent),
          radial-gradient(1px 1px at 50% 50%, white, transparent),
          radial-gradient(1px 1px at 80% 10%, white, transparent),
          radial-gradient(2px 2px at 90% 60%, white, transparent),
          radial-gradient(1px 1px at 33% 80%, white, transparent),
          radial-gradient(1px 1px at 15% 55%, white, transparent);
        background-size: 200% 200%;
        animation: twinkle 8s ease-in-out infinite;
        opacity: 0.7;
      }
      @keyframes twinkle {
        0%, 100% { opacity: 0.7; }
        50% { opacity: 1; }
      }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const Piano = () => {
          const [isPlaying, setIsPlaying] = React.useState(false);
          const [selectedSong, setSelectedSong] = React.useState('');
          const [customSheet, setCustomSheet] = React.useState('');
          const [activeKey, setActiveKey] = React.useState(null);
          const [savedSheets, setSavedSheets] = React.useState({});
          const [newSheetName, setNewSheetName] = React.useState('');
          const audioContextRef = React.useRef(null);
          const timeoutsRef = React.useRef([]);

          const keyboardMap = {
            'a': 'C4', 'w': 'C#4', 's': 'D4', 'e': 'D#4', 'd': 'E4',
            'f': 'F4', 't': 'F#4', 'g': 'G4', 'y': 'G#4', 'h': 'A4',
            'u': 'A#4', 'j': 'B4', 'k': 'C5', 'o': 'C#5', 'l': 'D5',
            'p': 'D#5', ';': 'E5', "'": 'F5'
          };

          const generatePianoKeys = () => {
            const notes = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];
            const keys = [];
            
            keys.push({ note: 'A0', freq: 27.50, white: true });
            keys.push({ note: 'A#0', freq: 29.14, white: false });
            keys.push({ note: 'B0', freq: 30.87, white: true });
            
            for (let octave = 1; octave <= 8; octave++) {
              for (let i = 0; i < notes.length; i++) {
                const note = notes[i];
                const isWhite = !note.includes('#');
                const freq = 440 * Math.pow(2, (octave - 4) + (i - 9) / 12);
                keys.push({ 
                  note: note + octave, 
                  freq: freq, 
                  white: isWhite
                });
                if (octave === 8 && note === 'C') break;
              }
            }
            
            return keys;
          };

          const allKeys = generatePianoKeys();
          const displayKeys = allKeys.filter(key => {
            const octave = parseInt(key.note.match(/\d+/)[0]);
            return octave >= 3 && octave <= 5;
          });

          React.useEffect(() => {
            audioContextRef.current = new (window.AudioContext || window.webkitAudioContext)();
            loadSavedSheets();
            
            const handleKeyDown = (e) => {
              const key = e.key.toLowerCase();
              if (keyboardMap[key] && !isPlaying) {
                const pianoKey = allKeys.find(k => k.note === keyboardMap[key]);
                if (pianoKey) {
                  handleKeyPress(pianoKey);
                }
              }
            };

            window.addEventListener('keydown', handleKeyDown);
            
            return () => {
              stopPlayback();
              window.removeEventListener('keydown', handleKeyDown);
              if (audioContextRef.current) {
                audioContextRef.current.close();
              }
            };
          }, [isPlaying]);

          const loadSavedSheets = () => {
            try {
              const saved = localStorage.getItem('pianoSheets');
              if (saved) {
                setSavedSheets(JSON.parse(saved));
              }
            } catch (e) {
              console.log('No saved sheets');
            }
          };

          const saveSheet = () => {
            if (newSheetName && customSheet) {
              const newSheets = Object.assign({}, savedSheets, { [newSheetName]: customSheet });
              localStorage.setItem('pianoSheets', JSON.stringify(newSheets));
              setSavedSheets(newSheets);
              setSelectedSong(newSheetName);
              setNewSheetName('');
              alert('Sheet saved!');
            }
          };

          const deleteSheet = (sheetName) => {
            if (confirm('Delete "' + sheetName + '"?')) {
              const newSheets = Object.assign({}, savedSheets);
              delete newSheets[sheetName];
              localStorage.setItem('pianoSheets', JSON.stringify(newSheets));
              setSavedSheets(newSheets);
              if (selectedSong === sheetName) setSelectedSong('');
            }
          };

          const playNote = (frequency, duration) => {
            duration = duration || 300;
            const ctx = audioContextRef.current;
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();
            const filter = ctx.createBiquadFilter();

            osc.connect(filter);
            filter.connect(gain);
            gain.connect(ctx.destination);

            osc.frequency.value = frequency;
            osc.type = 'triangle';
            filter.type = 'lowpass';
            filter.frequency.value = frequency * 4;

            const release = duration / 1000;
            gain.gain.setValueAtTime(0, ctx.currentTime);
            gain.gain.linearRampToValueAtTime(0.5, ctx.currentTime + 0.002);
            gain.gain.linearRampToValueAtTime(0.3, ctx.currentTime + 0.1);
            gain.gain.linearRampToValueAtTime(0, ctx.currentTime + release);

            osc.start(ctx.currentTime);
            osc.stop(ctx.currentTime + release);
          };

          const parseSheet = (sheet) => {
            const notes = sheet.trim().split(/\s+/);
            return notes.map(noteStr => {
              const parts = noteStr.split('-');
              if (parts.length === 2) {
                return { note: parts[0].trim().toUpperCase(), duration: parseInt(parts[1]) || 500 };
              }
              return null;
            }).filter(n => n !== null);
          };

          const handleKeyPress = (key) => {
            playNote(key.freq);
            setActiveKey(key.note);
            setTimeout(() => setActiveKey(null), 200);
          };

          const stopPlayback = () => {
            setIsPlaying(false);
            timeoutsRef.current.forEach(t => clearTimeout(t));
            timeoutsRef.current = [];
            setActiveKey(null);
          };

          const playSong = (sheet) => {
            stopPlayback();
            
            if (!sheet || !sheet.trim()) {
              alert('No sheet music to play!');
              return;
            }
            
            const songNotes = parseSheet(sheet);
            if (songNotes.length === 0) {
              alert('Invalid format! Use: C4-500 D4-300');
              return;
            }
            
            setIsPlaying(true);
            let delay = 0;

            songNotes.forEach((item, i) => {
              const key = allKeys.find(k => k.note === item.note);
              const timeout = setTimeout(() => {
                if (key) {
                  playNote(key.freq, item.duration);
                  setActiveKey(item.note);
                  setTimeout(() => setActiveKey(null), item.duration);
                }
                if (i === songNotes.length - 1) setIsPlaying(false);
              }, delay);
              
              timeoutsRef.current.push(timeout);
              delay += item.duration + 50;
            });
          };

          const handlePlay = () => {
            const sheet = selectedSong && savedSheets[selectedSong] ? savedSheets[selectedSong] : customSheet;
            if (sheet) {
              playSong(sheet);
            } else {
              alert('Enter sheet music or select a saved sheet!');
            }
          };

          const loadToEditor = (name) => {
            setCustomSheet(savedSheets[name]);
            setSelectedSong('');
          };

          const getKeyboardKey = (note) => {
            for (let key in keyboardMap) {
              if (keyboardMap[key] === note) {
                return key.toUpperCase();
              }
            }
            return '';
          };

          const isMobile = window.innerWidth < 768;

          return React.createElement('div', { 
            className: 'stars-bg min-h-screen p-2 sm:p-4'
          },
            React.createElement('div', { className: 'max-w-7xl mx-auto relative z-10' },
              React.createElement('h1', { 
                className: 'text-2xl sm:text-3xl md:text-5xl font-bold text-white text-center mb-3 sm:mb-4 md:mb-8 drop-shadow-lg' 
              }, 'üéπ Piano Sheet Player'),

              React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-2 gap-2 sm:gap-4 mb-3 sm:mb-4' },
                React.createElement('div', { className: 'bg-white/20 backdrop-blur-lg rounded-lg sm:rounded-xl p-3 sm:p-4 shadow-xl' },
                  React.createElement('h2', { className: 'text-white text-base sm:text-lg font-semibold mb-2 sm:mb-3' }, 'üìö My Saved Sheets'),
                  
                  Object.keys(savedSheets).length === 0 ? 
                    React.createElement('div', { className: 'text-white/70 text-center py-6 sm:py-8 text-xs sm:text-sm' }, 'No saved sheets yet!') :
                    React.createElement('div', { className: 'max-h-32 sm:max-h-48 overflow-y-auto mb-3 sm:mb-4 space-y-1 sm:space-y-2' },
                      Object.keys(savedSheets).map(name =>
                        React.createElement('div', { key: name, className: 'flex gap-1 sm:gap-2 bg-white/10 p-1.5 sm:p-2 rounded' },
                          React.createElement('button', {
                            onClick: () => setSelectedSong(name),
                            className: 'flex-1 text-left px-2 sm:px-3 py-1.5 sm:py-2 rounded text-xs sm:text-sm ' + (selectedSong === name ? 'bg-blue-600 text-white' : 'bg-white/10 text-white hover:bg-white/20')
                          }, name),
                          React.createElement('button', {
                            onClick: () => loadToEditor(name),
                            className: 'px-2 sm:px-3 py-1.5 sm:py-2 bg-blue-500 hover:bg-blue-600 text-white rounded text-xs sm:text-sm'
                          }, 'Edit'),
                          React.createElement('button', {
                            onClick: () => deleteSheet(name),
                            className: 'p-1.5 sm:p-2 bg-red-500 hover:bg-red-600 text-white rounded text-sm'
                          }, 'üóëÔ∏è')
                        )
                      )
                    ),
                  
                  React.createElement('div', { className: 'flex gap-2' },
                    React.createElement('button', {
                      onClick: handlePlay,
                      disabled: isPlaying,
                      className: 'flex-1 px-3 sm:px-4 py-2 sm:py-2.5 bg-green-500 hover:bg-green-600 disabled:bg-gray-500 disabled:cursor-not-allowed text-white rounded-lg font-semibold text-sm sm:text-base shadow-lg'
                    }, '‚ñ∂Ô∏è Play'),
                    React.createElement('button', {
                      onClick: stopPlayback,
                      disabled: !isPlaying,
                      className: 'px-3 sm:px-4 py-2 sm:py-2.5 bg-red-500 hover:bg-red-600 disabled:bg-gray-500 disabled:cursor-not-allowed text-white rounded-lg font-semibold text-sm sm:text-base shadow-lg'
                    }, '‚è∏Ô∏è Stop')
                  )
                ),

                React.createElement('div', { className: 'bg-white/20 backdrop-blur-lg rounded-lg sm:rounded-xl p-3 sm:p-4 shadow-xl' },
                  React.createElement('h2', { className: 'text-white text-base sm:text-lg font-semibold mb-2 sm:mb-3' }, '‚úèÔ∏è Create Custom Sheet'),
                  React.createElement('textarea', {
                    value: customSheet,
                    onChange: (e) => { setCustomSheet(e.target.value); setSelectedSong(''); },
                    placeholder: 'C4-500 E4-500 G4-500 C5-1000',
                    className: 'w-full px-2 sm:px-3 py-2 rounded-lg bg-white/30 text-white placeholder-white/60 border border-white/40 focus:outline-none focus:ring-2 focus:ring-blue-400 mb-2 h-24 sm:h-32 resize-none font-mono text-xs sm:text-sm shadow-inner',
                    disabled: isPlaying
                  }),
                  
                  React.createElement('div', { className: 'flex gap-2' },
                    React.createElement('input', {
                      type: 'text',
                      value: newSheetName,
                      onChange: (e) => setNewSheetName(e.target.value),
                      placeholder: 'Sheet name...',
                      className: 'flex-1 px-2 sm:px-3 py-1.5 sm:py-2 rounded-lg bg-white/30 text-white placeholder-white/60 border border-white/40 focus:outline-none focus:ring-2 focus:ring-blue-400 text-xs sm:text-sm shadow-inner'
                    }),
                    React.createElement('button', {
                      onClick: saveSheet,
                      disabled: !newSheetName || !customSheet,
                      className: 'px-3 sm:px-4 py-1.5 sm:py-2 bg-blue-500 hover:bg-blue-600 disabled:bg-gray-500 disabled:cursor-not-allowed text-white rounded-lg font-semibold text-xs sm:text-sm shadow-lg'
                    }, 'üíæ Save')
                  )
                )
              ),

              React.createElement('div', { className: 'bg-white/20 backdrop-blur-lg rounded-lg sm:rounded-xl p-2 sm:p-3 md:p-6 overflow-x-auto shadow-xl mb-3 sm:mb-4' },
                React.createElement('div', { className: 'relative inline-flex min-w-full justify-center' },
                  displayKeys.map((key, i) => {
                    const kbKey = getKeyboardKey(key.note);
                    return key.white ?
                      React.createElement('button', {
                        key: key.note,
                        onClick: () => handleKeyPress(key),
                        className: 'relative border-2 border-gray-800 rounded-b-lg transition-all shadow-lg ' + (activeKey === key.note ? 'bg-gradient-to-b from-yellow-300 to-yellow-500 scale-95' : 'bg-gradient-to-b from-white to-gray-200 hover:from-gray-100 hover:to-gray-300'),
                        style: { width: isMobile ? '2.5rem' : '4rem', height: isMobile ? '8rem' : '16rem' }
                      },
                        React.createElement('div', { className: 'absolute left-0 right-0 text-center' , style: { bottom: isMobile ? '0.5rem' : '1rem' }},
                          React.createElement('div', { className: 'text-gray-700 font-bold text-xs sm:text-sm' }, key.note),
                          kbKey && React.createElement('div', { className: 'text-gray-500 text-xs mt-0.5' }, kbKey)
                        )
                      ) :
                      React.createElement('button', {
                        key: key.note,
                        onClick: () => handleKeyPress(key),
                        className: 'absolute rounded-b-lg z-10 transition-all shadow-xl ' + (activeKey === key.note ? 'bg-gradient-to-b from-purple-500 to-purple-700 scale-95' : 'bg-gradient-to-b from-gray-900 to-black hover:from-gray-800 hover:to-gray-900'),
                        style: { 
                          width: isMobile ? '1.75rem' : '2.75rem', 
                          height: isMobile ? '5rem' : '10rem',
                          left: (Math.floor(i * 0.7) + 0.65) * (isMobile ? 40 : 64) + 'px'
                        }
                      },
                        React.createElement('div', { className: 'absolute left-0 right-0 text-center', style: { bottom: isMobile ? '0.25rem' : '0.5rem' }},
                          React.createElement('div', { className: 'text-white text-xs' }, key.note),
                          kbKey && React.createElement('div', { className: 'text-white/70 text-xs mt-0.5' }, kbKey)
                        )
                      )
                  })
                )
              ),

              React.createElement('div', { className: 'bg-white/20 backdrop-blur-lg rounded-lg sm:rounded-xl p-3 sm:p-4 text-white text-xs sm:text-sm shadow-xl' },
                React.createElement('h3', { className: 'font-semibold mb-2 text-sm sm:text-base' }, 'üìù How to Use:'),
                React.createElement('p', { className: 'mb-1 sm:mb-2' }, '‚Ä¢ Format: NOTE-DURATION (e.g., C4-500 E4-500)'),
                React.createElement('p', { className: 'mb-1 sm:mb-2' }, '‚Ä¢ Use keyboard keys to play (A-L on PC)'),
                React.createElement('p', { className: 'mb-2 sm:mb-3' }, '‚Ä¢ Duration in milliseconds (500 = 0.5 sec)'),
                React.createElement('div', { className: 'mt-2 sm:mt-3 p-2 sm:p-3 bg-green-500/30 rounded-lg border border-green-400/50' },
                  React.createElement('p', { className: 'font-semibold mb-1' }, 'üéµ Try "Twinkle Twinkle":'),
                  React.createElement('code', { className: 'text-xs block bg-black/30 p-2 rounded overflow-x-auto' }, 
                    'C4-500 C4-500 G4-500 G4-500 A4-500 A4-500 G4-1000 F4-500 F4-500 E4-500 E4-500 D4-500 D4-500 C4-1000'
                  )
                )
              )
            )
          );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(Piano));
    </script>
</body>
</html>
